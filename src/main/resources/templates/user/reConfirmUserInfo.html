<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">

<head>
	<meta charset="UTF-8">
	<title>회원정보 재확인</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen px-4">
	<div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-lg">
		<h2 class="text-2xl font-bold mb-6 text-center text-blue-600">회원정보 재확인</h2>
		<input id="num" name="num" th:value="${num}" hidden />

		<div class="mb-4">
			<label for="email" class="block text-sm text-gray-700 mb-1">이메일</label>
			<input type="text" name="email" id="email" th:value="${email}"
				class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
				readonly />
		</div>

		<div class="mb-4">
			<label for="pwd" class="block text-sm text-gray-700 mb-1">비밀번호</label>
			<input type="password" name="pwd" id="pwd"
				class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
				placeholder="비밀번호 입력" />
		</div>

		<button type="button" onclick="validateUser(event)"
			class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition">확인</button>
	</div>

</body>

</html>

<th:block layout:fragment="script">
	<script th:inline="javascript">
		function validateUser(event) {
			event.preventDefault();

			const num = $("#num").val();
			const email = $("#email").val();
			const enteredPwd = $("#pwd").val();

			const data = {
				email: email,
				enteredPwd: enteredPwd
			}

			if (enteredPwd == "") {
				alert("비밀번호를 입력해주세요.");
				$("#pwd").focus();
				return false;
			}

			$.ajax({
				type: "POST",
				url: "/api/validateUser",
				data: JSON.stringify(data),
				contentType: "application/json",

				success: function (result) {
					if (result === 1) {
						window.location.href = `/mypage/editProfile?num=${num}`;
					} else {
						alert("비밀번호가 일치하지 않습니다.");
						$("#pwd").focus();
						return false;
					}
				},
				error: function (request, status, error) {
					alert("회원정보 재확인 오류\n code: " + request.status + "\n error: " + error);
				}
			});
		}
	</script>
</th:block>